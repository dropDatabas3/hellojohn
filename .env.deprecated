# --- Entorno ---
APP_ENV=dev  # dev|staging|prod

# --- Server ---
SERVER_ADDR=:8080
SERVER_CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000,http://localhost:3001

# --- Control Plane FS Root ---
CONTROL_PLANE_FS_ROOT=./data/hellojohn

# --- Storage ---
STORAGE_DRIVER=postgres
STORAGE_DSN=postgres://user:password@localhost:5432/login?sslmode=disable
POSTGRES_MAX_OPEN_CONNS=30
POSTGRES_MAX_IDLE_CONNS=5
POSTGRES_CONN_MAX_LIFETIME=30m

# --- Cache / Rate ---
CACHE_KIND=redis
REDIS_ADDR=localhost:6379
REDIS_DB=0
REDIS_PREFIX=login:
RATE_ENABLED=true
RATE_WINDOW=1m
RATE_MAX_REQUESTS=60
# Límites por endpoint (usados por los handlers si hay limiter pool)
RATE_LOGIN_LIMIT=10
RATE_LOGIN_WINDOW=1m
RATE_FORGOT_LIMIT=5
RATE_FORGOT_WINDOW=10m

# --- JWT ---
JWT_ISSUER=http://localhost:8080
JWT_ACCESS_TTL=15m
JWT_REFRESH_TTL=720h
SECRETBOX_MASTER_KEY=iffiWk2LBdtpvTp53ogGxbLDGFWJY8JkqPvej0qIT44=

# --- Register / Auth ---
REGISTER_AUTO_LOGIN=true
AUTH_ALLOW_BEARER_SESSION=true
AUTH_SESSION_COOKIE_NAME=sid
AUTH_SESSION_DOMAIN=
AUTH_SESSION_SAMESITE=Lax
AUTH_SESSION_SECURE=false
AUTH_SESSION_TTL=12h

AUTH_RESET_TTL=1h
AUTH_RESET_AUTO_LOGIN=true
AUTH_VERIFY_TTL=48h

# --- MFA (ENV-ONLY) ---
# Ventanas de TOTP aceptadas (desplazamiento ±window)
MFA_TOTP_WINDOW=1
# Nombre de issuer que verás en la app TOTP
MFA_TOTP_ISSUER=HelloJohn
# TTL del "remember device"
MFA_REMEMBER_TTL=720h

# Clave maestra para cifrado AES-GCM (32 bytes recomendado).
# En dev está bien hardcodear; en prod, gestionar seguro (KMS, vault, etc.).
SIGNING_MASTER_KEY=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef


# --- SMTP (Gmail STARTTLS en 587) ---
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=juanpalacio1996@gmail.com
SMTP_PASSWORD=gezl zchi oken ubkl
SMTP_FROM=juanpalacio1996@gmail.com
SMTP_TLS=starttls
SMTP_INSECURE_SKIP_VERIFY=false

# --- Email ---
EMAIL_BASE_URL=http://localhost:8080
EMAIL_TEMPLATES_DIR=./templates
EMAIL_DEBUG_LINKS=true  # En prod se fuerza a false por seguridad

# --- Seguridad (password policy) ---
SECURITY_PASSWORD_POLICY_MIN_LENGTH=10
SECURITY_PASSWORD_POLICY_REQUIRE_UPPER=true
SECURITY_PASSWORD_POLICY_REQUIRE_LOWER=true
SECURITY_PASSWORD_POLICY_REQUIRE_DIGIT=true
SECURITY_PASSWORD_POLICY_REQUIRE_SYMBOL=false

# --- Flags ---
FLAGS_MIGRATE=true

# ───────── Providers: Google ─────────
GOOGLE_ENABLED=true
GOOGLE_CLIENT_ID=1090604839946-j132hvbd6s0aijfsd57444i9u9dep2hn.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=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
GOOGLE_REDIRECT_URL=http://localhost:8080/v1/auth/social/google/callback
GOOGLE_SCOPES=openid,email,profile
GOOGLE_ALLOWED_TENANTS=
GOOGLE_ALLOWED_CLIENTS=

# ───────── Social (TTL del código devuelto por /social/result) ─────────
SOCIAL_LOGIN_CODE_TTL=60s

# ───────── Opcional: SEED (cmd/seed) ─────────
# SEED_TENANT_SLUG=local
# SEED_TENANT_NAME=Local Tenant
# SEED_ADMIN_EMAIL=admin@local.test
# SEED_ADMIN_PASSWORD=SuperS3creta!
# SEED_MFA_EMAIL=mfa@local.test
# SEED_MFA_PASSWORD=CorrectHorseBatteryStaple1!
# SEED_UNVERIFIED_EMAIL=new@local.test
# SEED_UNVERIFIED_PASSWORD=Password.1234
# SEED_CLIENT_ID=web-frontend
# SEED_CLIENT_NAME=Web Frontend
# SEED_CLIENT_TYPE=public
# SEED_BACKEND_CLIENT_ID=backend-api
# SEED_BACKEND_CLIENT_NAME=Backend API
# SEED_BACKEND_CLIENT_TYPE=confidential
# SEED_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
# SEED_REDIRECT_URIS=http://localhost:3000/callback,http://localhost:8080/v1/auth/social/result
# SEED_PROVIDERS=password,google
# SEED_SCOPES=openid,email,profile,offline_access

# Obliga a pasar por el gate de admin (sino queda en modo compat y el NO-ADMIN podría pasar).
ADMIN_ENFORCE=1

# Lista CSV de SUBs que se consideran admin (fallback simple).
# Usá el Admin SUB que te imprimió el seed:
ADMIN_SUBS=7da4fb61-cb3a-4d7f-a6cd-a9ec4d82440d

# Autoconsent básico (para UX first-party). Poner "0" para modo estricto.
CONSENT_AUTO=1

FS_ADMIN_ENABLE=1
# Set de scopes autoconsentibles
CONSENT_AUTO_SCOPES=openid email profile
